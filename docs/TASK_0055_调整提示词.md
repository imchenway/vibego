# /TASK_0055 调整提示词（PLAN）

## 1. 背景（现状）

在 Telegram「🚀 推送到模型」流程中，当任务存在 `related_task_id` 且处于 `research/test` 状态时，当前会在提示词末尾追加整段关联任务上下文：

```text
关联任务信息：
任务标题：...
任务编码：...
任务描述：...
补充任务描述：...
附件列表：...
以下为任务执行记录...
```

该展开内容会显著拉长提示词，且用户只需要知道“是否有关联任务”即可。

## 2. 目标（用户口径）

将关联任务展示从“整段展开”改为“仅透传编码”：

- 移除提示词中的 `关联任务信息：...` 关联任务详情块（不再展开标题/描述/附件/历史）
- 主任务字段中固定增加一行：
  - 有关联：`关联任务编码：/TASK_XXXX`
  - 无关联/无效：`关联任务编码：-`

> 决策记录：1A（移除展开块）/ 2A（有则填真实编码）/ 3A（无则输出 `-`）✅

## 3. 验收标准（AC，可测试）

1) `research/test` 状态推送到模型时，提示词不再包含 `关联任务信息：`。  
2) `research/test` 状态推送到模型时，提示词固定包含 `关联任务编码：...`。  
3) 当 `related_task_id` 为空/无效/等于自身任务时，输出 `关联任务编码：-`。  
4) 回归测试通过。  

## 4. 变更点（Design + Develop）

- `bot.py`
  - `_push_task_to_model()`：移除关联任务上下文块的拼接逻辑（不再 fetch 关联任务详情）
  - `_build_model_push_payload()`：在 `research/test` 主模板中新增 `关联任务编码：...` 字段
- `tests/test_task_description.py`
  - 更新“推送到模型 + 关联任务”场景断言：从 `关联任务信息` 改为 `关联任务编码`

## 5. 参考资料（可验证）

- 代码实现位置：`bot.py` `_push_task_to_model()` / `_build_model_push_payload()`  
- 回归用例：`tests/test_task_description.py`（推送到模型关联任务场景）  

## 6. 自测

```bash
python3.11 -m pytest -q
```

